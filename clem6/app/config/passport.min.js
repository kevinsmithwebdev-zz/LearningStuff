var localStrategy=require("passport-local").Strategy,User=require("../models/users"),configAuth=require("./auth");
module.exports=function(f){f.serializeUser(function(a,b){b(null,a.id)});f.deserializeUser(function(a,b){User.findById(a,function(c,e){b(c,e)})});f.use(new localStrategy({clientID:configAuth.localAuth.clientID,clientSecret:configAuth.localAuth.clientSecret,callbackURL:configAuth.localAuth.callbackURL},function(a,b,c,e){process.nextTick(function(){User.findOne({"local.id":c.id},function(a,b){if(a)return e(a);if(b)return e(null,b);var d=new User;d.local.id=c.id;d.local.username=c.username;d.local.displayName=
c.displayName;d.local.publicRepos=c._json.public_repos;d.nbrClicks.clicks=0;d.save(function(a){if(a)throw a;return e(null,d)})})})}))};
