var GitHubStrategy=require("passport-github").Strategy,User=require("../models/users"),configAuth=require("./auth");
module.exports=function(f){f.serializeUser(function(a,b){b(null,a.id)});f.deserializeUser(function(a,b){User.findById(a,function(c,e){b(c,e)})});f.use(new GitHubStrategy({clientID:configAuth.githubAuth.clientID,clientSecret:configAuth.githubAuth.clientSecret,callbackURL:configAuth.githubAuth.callbackURL},function(a,b,c,e){process.nextTick(function(){User.findOne({"github.id":c.id},function(a,b){if(a)return e(a);if(b)return e(null,b);var d=new User;d.github.id=c.id;d.github.username=c.username;d.github.displayName=
c.displayName;d.github.publicRepos=c._json.public_repos;d.nbrClicks.clicks=0;d.save(function(a){if(a)throw a;return e(null,d)})})})}))};
