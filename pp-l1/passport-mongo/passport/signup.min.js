var LocalStrategy=require("passport-local").Strategy,User=require("../models/user"),bCrypt=require("bcrypt-nodejs");
module.exports=function(c){c.use("signup",new LocalStrategy({passReqToCallback:!0},function(a,d,c,e){findOrCreateUser=function(){User.findOne({username:d},function(f,g){if(f)return console.log("Error in SignUp: "+f),e(f);if(g)return console.log("User already exists with username: "+d),e(null,!1,a.flash("message","User Already Exists"));var b=new User;b.username=d;b.password=bCrypt.hashSync(c,bCrypt.genSaltSync(10),null);b.email=a.param("email");b.firstName=a.param("firstName");b.lastName=a.param("lastName");
b.save(function(a){if(a)throw console.log("Error in Saving user: "+a),a;console.log("User Registration succesful");return e(null,b)})})};process.nextTick(findOrCreateUser)}))};
