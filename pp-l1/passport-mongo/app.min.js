var express=require("express"),path=require("path"),favicon=require("static-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),dbConfig=require("./db"),mongoose=require("mongoose");mongoose.connect(dbConfig.url);var app=express();app.set("views",path.join(__dirname,"views"));app.set("view engine","jade");app.use(favicon());app.use(logger("dev"));app.use(bodyParser.json());app.use(bodyParser.urlencoded());app.use(cookieParser());
app.use(express["static"](path.join(__dirname,"public")));var passport=require("passport"),expressSession=require("express-session");app.use(expressSession({secret:"mySecretKey"}));app.use(passport.initialize());app.use(passport.session());var flash=require("connect-flash");app.use(flash());var initPassport=require("./passport/init");initPassport(passport);var routes=require("./routes/index")(passport);app.use("/",routes);app.use(function(a,c,b){a=Error("Not Found");a.status=404;b(a)});
"development"===app.get("env")&&app.use(function(a,c,b,d){b.status(a.status||500);b.render("error",{message:a.message,error:a})});module.exports=app;
