var express=require("express"),path=require("path"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),index=require("./routes/index"),users=require("./routes/users"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy,app=express();app.set("views",path.join(__dirname,"views"));app.set("view engine","jade");app.use(logger("dev"));app.use(bodyParser.json());app.use(bodyParser.urlencoded({extended:!1}));
app.use(cookieParser());app.use(express["static"](path.join(__dirname,"public")));app.use("/",index);app.use("/users",users);app.use(function(a,b,c){a=Error("Not Found");a.status=404;c(a)});app.use(function(a,b,c,d){c.locals.message=a.message;c.locals.error="development"===b.app.get("env")?a:{};c.status(a.status||500);c.render("error")});app.use(app.router);app.use(passport.initialize());app.use(passport.session());app.get("/login",function(a,b){b.sendfile("views/login.html")});
app.post("/login",passport.authenticate("local",{successRedirect:"/loginSuccess",failureRedirect:"/loginFailure"}));app.get("/loginFailure",function(a,b,c){b.send("Failed to authenticate")});app.get("/loginSuccess",function(a,b,c){b.send("Successfully authenticated")});passport.serializeUser(function(a,b){b(null,a)});passport.deserializeUser(function(a,b){b(null,a)});passport.use(new LocalStrategy(function(a,b,c){process.nextTick(function(){})}));module.exports=app;
